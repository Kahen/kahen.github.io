---
date: 2022-04-01
category:
  - JVM内存类型
tag:
  - Java
  - JVM
  - 内存管理
head:
  - - meta
    - name: keywords
      content: Java虚拟机, JVM内存, 堆内存, 栈内存, 直接内存
------
# Java虚拟机中的内存类型

在这篇简短的教程中，我们将快速了解Java虚拟机（JVM）中的内存类型。

JVM使用不同类型的内存来满足不同的目的，每种内存都有其自身的特点和行为。了解JVM中的不同内存类型对于设计高效稳定的应用程序至关重要。

## 2. 堆内存

当JVM启动时，它会创建堆内存。**这种内存类型是JVM的一个关键组成部分，因为它存储了应用程序创建的所有对象。**

内存的大小在应用程序运行时可能会增加或减少。然而，我们可以使用`-Xms`参数指定堆内存的初始大小：

```shell
java -Xms4096M ClassName
```

此外，我们可以使用`-Xmx`参数定义堆的最大大小：

```shell
java -Xms4096M -Xmx6144M ClassName
```

如果应用程序的堆使用量达到最大大小并且仍然需要更多内存，它将生成一个`OutOfMemoryError: Java heap space`错误。

## 3. 栈内存

在这种内存类型中，JVM存储局部变量和方法信息。

此外，Java使用栈内存进行线程执行。在一个应用程序中，每个线程都有自己的栈，存储它当前正在使用的方法和变量信息。

然而，它不是由垃圾收集管理，而是由JVM本身管理。

**栈内存的大小是固定的，由JVM在运行时确定。**如果栈内存耗尽，JVM将抛出`StackOverflowError`错误。

为了避免这种潜在问题，设计应用程序以有效使用栈内存至关重要。

## 4. 原生内存

在Java堆之外分配并由JVM使用的内存称为原生内存。它也被称为非堆内存。

由于原生内存中的数据位于JVM之外，我们需要执行序列化来读取和写入数据。性能取决于缓冲区、序列化过程和磁盘空间。

此外，由于其位于JVM之外，它不会被垃圾收集器释放。

**在原生内存中，JVM存储线程栈、内部数据结构和内存映射文件。**

JVM和原生库使用原生内存来执行不能完全用Java完成的操作，例如与操作系统交互或访问硬件资源。

## 5. 直接内存

直接缓冲区内存是在Java堆之外分配的。它代表了JVM进程使用的操作系统的原生内存。

**Java NIO使用这种内存类型以更有效的方式将数据写入网络或磁盘。**

因为直接缓冲区不会被垃圾收集器释放，它们对应用程序内存占用的影响可能不是很明显。因此，直接缓冲区应该主要分配给在I/O操作中使用的大缓冲区。

在Java中使用直接缓冲区，我们调用`ByteBuffer`上的`allocateDirect()`方法：

```java
ByteBuffer directBuf = ByteBuffer.allocateDirect(1024);
```

当加载文件到内存时，Java使用直接内存分配一系列`DirectByteBuffer`s。这样，它减少了相同字节被复制的次数。缓冲区有一个类负责在文件不再需要时释放内存。

我们可以使用`-XX:MaxDirectMemorySize`参数限制直接缓冲区内存的大小：

```shell
-XX:MaxDirectMemorySize=1024M
```

如果原生内存使用了所有为直接字节缓冲区分配的空间，将发生`OutOfMemoryError: Direct buffer memory`错误。

## 6. 结论

在这篇短文中，我们了解了JVM中的不同内存类型。为了确保我们应用程序的性能和稳定性，了解JVM中的内存类型很有帮助。