import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,o as t,a as n}from"./app-Dj7PNGjp.js";const r={},s=n(`<hr><h1 id="tomcat警告-为了防止内存泄漏-jdbc驱动已被强制注销-baeldung-1-概述" tabindex="-1"><a class="header-anchor" href="#tomcat警告-为了防止内存泄漏-jdbc驱动已被强制注销-baeldung-1-概述"><span>Tomcat警告：“为了防止内存泄漏，JDBC驱动已被强制注销” | Baeldung## 1. 概述</span></a></h1><p>在本教程中，我们将探讨Tomcat发出的警告消息，该消息通知我们它强制注销了一个JDBC驱动。我们将探索消息的含义、其根本原因以及我们可以采取的缓解措施。</p><h2 id="_2-消息及其含义" tabindex="-1"><a class="header-anchor" href="#_2-消息及其含义"><span>2. 消息及其含义</span></a></h2><p>消息的一个版本可能是以下内容：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>SEVERE: 一个Web应用程序注册了JBDC驱动 [oracle.jdbc.driver.OracleDriver]
  但在Web应用程序停止时未能注销它。
  为了防止内存泄漏，JDBC驱动已被强制注销。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上消息表明，当我们部署Web应用程序时，注册了_OracleDriver_类的JDBC驱动，但在相同的应用程序被卸载时，它并未被注销。</p><p>我们可以通过多种方式加载和注册JDBC驱动，它本质上是一个扩展了_java.sql.Driver_接口的类。Tomcat使用Java服务提供者接口（SPI），并<strong>自动加载它在Web应用程序的_WEB-INF/lib_目录下找到的任何JDBC 4.0兼容驱动类</strong>。</p><p>当我们卸载一个Web应用程序时，我们还必须注销它带来的任何驱动。否则，它们将一直与Tomcat注册在一起。<strong>这会创建一个内存泄漏，直到我们关闭整个Web服务器</strong>。</p><p>从6.0.24版本开始，Tomcat检测到这种类型的泄漏，并强制注销所有泄漏的驱动。然而，它仍然通知我们这个问题，这在我们将相同的应用程序部署到不支持此功能的其他Web服务器上时非常有帮助。</p><h2 id="_3-根本原因及潜在问题" tabindex="-1"><a class="header-anchor" href="#_3-根本原因及潜在问题"><span>3. 根本原因及潜在问题</span></a></h2><p>问题的原因在于JDBC驱动的不当实现。它应该监听应用程序卸载事件并自行注销。</p><p>当Java SPI加载JDBC驱动时，它使用当前上下文类加载器加载它。由于驱动位于应用程序的_WEB-INF/lib_下，SPI使用其类加载器加载它。<strong>以这种方式加载的驱动与_DriverManager_类注册，这是一个JVM单例。如果这没有发生，它将在加载的类中引入内存泄漏</strong>。</p><p>当我们卸载Web应用程序时，其类加载器被垃圾回收。<strong>另一方面，_DriverManager_仍然引用JDBC驱动，阻止垃圾回收</strong>。如果我们再次部署相同的Web应用程序，将创建一个新的类加载器，SPI将第二次加载相同的JDBC驱动。这实际上是一个内存泄漏。</p><h2 id="_4-缓解措施" tabindex="-1"><a class="header-anchor" href="#_4-缓解措施"><span>4. 缓解措施</span></a></h2><p>我们可以通过多种方式缓解这个问题。</p><h3 id="_4-1-使用更新的tomcat版本" tabindex="-1"><a class="header-anchor" href="#_4-1-使用更新的tomcat版本"><span>4.1. 使用更新的Tomcat版本</span></a></h3><p>从6.0.24版本开始，Tomcat为我们自动处理这个问题。<strong>这意味着我们可以安全地忽略警告消息</strong>。</p><h3 id="_4-2-在关闭时手动注销" tabindex="-1"><a class="header-anchor" href="#_4-2-在关闭时手动注销"><span>4.2. 在关闭时手动注销</span></a></h3><p>我们可以在任何应用程序关闭回调上手动注销驱动。在我们应用程序将加载一个JDBC驱动的标准情况下，我们可以用一行代码做到这一点：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">deregisterDriver</span><span class="token punctuation">(</span><span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getDrivers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>需要注意的是，尽管Tomcat调用操作注销，但_DriverManager_方法被称为注销。</p><h3 id="_4-3-移动jdbc-jar" tabindex="-1"><a class="header-anchor" href="#_4-3-移动jdbc-jar"><span>4.3. 移动JDBC Jar</span></a></h3><p>处理这个问题的官方方式是将JDBC驱动jar文件从应用程序的_WEB-INF/lib_移动到Tomcat的/ _lib_目录。由于/ _lib_目录下的所有jar也位于类路径上，Tomcat仍将自动加载驱动，但使用它自己的类加载器。</p><p>Tomcat在部署应用程序时不会加载任何驱动实现，因为不会有任何驱动位于_WEB-INF/lib_。这意味着我们可以安全地卸载和重新部署它，而不会加载任何新内容，从而防止任何泄漏。</p><h2 id="_5-结论" tabindex="-1"><a class="header-anchor" href="#_5-结论"><span>5. 结论</span></a></h2><p>在本文中，我们讨论了Tomcat发出的JDBC驱动强制注销警告消息的含义。我们还查看了其根本原因以及可能的解决方法。</p><p>OK</p>`,28),o=[s];function c(i,l){return t(),a("div",null,o)}const m=e(r,[["render",c],["__file","2024-07-18-Tomcat Warning  To Prevent a Memory Leak  the JDBC Driver Has Been Forcibly Unregistered .html.vue"]]),h=JSON.parse('{"path":"/posts/baeldung/2024-07-18/2024-07-18-Tomcat%20Warning%20%20To%20Prevent%20a%20Memory%20Leak%20%20the%20JDBC%20Driver%20Has%20Been%20Forcibly%20Unregistered%20.html","title":"Tomcat警告：“为了防止内存泄漏，JDBC驱动已被强制注销” | Baeldung## 1. 概述","lang":"zh-CN","frontmatter":{"date":"2022-04-01T00:00:00.000Z","category":["Tomcat","JDBC"],"tag":["Memory Leak","JDBC Driver"],"head":[["meta",{"name":"keywords","content":"Tomcat, JDBC, Memory Leak, JDBC Driver"}],["meta",{"property":"og:url","content":"https://www.kahen.xyz/posts/baeldung/2024-07-18/2024-07-18-Tomcat%20Warning%20%20To%20Prevent%20a%20Memory%20Leak%20%20the%20JDBC%20Driver%20Has%20Been%20Forcibly%20Unregistered%20.html"}],["meta",{"property":"og:site_name","content":"Baeldung 中文网"}],["meta",{"property":"og:title","content":"Tomcat警告：“为了防止内存泄漏，JDBC驱动已被强制注销” | Baeldung## 1. 概述"}],["meta",{"property":"og:description","content":"Tomcat警告：“为了防止内存泄漏，JDBC驱动已被强制注销” | Baeldung## 1. 概述 在本教程中，我们将探讨Tomcat发出的警告消息，该消息通知我们它强制注销了一个JDBC驱动。我们将探索消息的含义、其根本原因以及我们可以采取的缓解措施。 2. 消息及其含义 消息的一个版本可能是以下内容： 以上消息表明，当我们部署Web应用程序时，..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-07-18T05:30:27.000Z"}],["meta",{"property":"article:author","content":"Kahen"}],["meta",{"property":"article:tag","content":"Memory Leak"}],["meta",{"property":"article:tag","content":"JDBC Driver"}],["meta",{"property":"article:published_time","content":"2022-04-01T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-07-18T05:30:27.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Tomcat警告：“为了防止内存泄漏，JDBC驱动已被强制注销” | Baeldung## 1. 概述\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-04-01T00:00:00.000Z\\",\\"dateModified\\":\\"2024-07-18T05:30:27.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Kahen\\",\\"url\\":\\"https://www.kahen.xyz\\"}]}"]],"description":"Tomcat警告：“为了防止内存泄漏，JDBC驱动已被强制注销” | Baeldung## 1. 概述 在本教程中，我们将探讨Tomcat发出的警告消息，该消息通知我们它强制注销了一个JDBC驱动。我们将探索消息的含义、其根本原因以及我们可以采取的缓解措施。 2. 消息及其含义 消息的一个版本可能是以下内容： 以上消息表明，当我们部署Web应用程序时，..."},"headers":[{"level":2,"title":"2. 消息及其含义","slug":"_2-消息及其含义","link":"#_2-消息及其含义","children":[]},{"level":2,"title":"3. 根本原因及潜在问题","slug":"_3-根本原因及潜在问题","link":"#_3-根本原因及潜在问题","children":[]},{"level":2,"title":"4. 缓解措施","slug":"_4-缓解措施","link":"#_4-缓解措施","children":[{"level":3,"title":"4.1. 使用更新的Tomcat版本","slug":"_4-1-使用更新的tomcat版本","link":"#_4-1-使用更新的tomcat版本","children":[]},{"level":3,"title":"4.2. 在关闭时手动注销","slug":"_4-2-在关闭时手动注销","link":"#_4-2-在关闭时手动注销","children":[]},{"level":3,"title":"4.3. 移动JDBC Jar","slug":"_4-3-移动jdbc-jar","link":"#_4-3-移动jdbc-jar","children":[]}]},{"level":2,"title":"5. 结论","slug":"_5-结论","link":"#_5-结论","children":[]}],"git":{"createdTime":1721280627000,"updatedTime":1721280627000,"contributors":[{"name":"Kahen","email":"Kahen@users.noreply.github.com","commits":1}]},"readingTime":{"minutes":3.41,"words":1023},"filePathRelative":"posts/baeldung/2024-07-18/2024-07-18-Tomcat Warning  To Prevent a Memory Leak  the JDBC Driver Has Been Forcibly Unregistered .md","localizedDate":"2022年4月1日","excerpt":"<hr>\\n<h1>Tomcat警告：“为了防止内存泄漏，JDBC驱动已被强制注销” | Baeldung## 1. 概述</h1>\\n<p>在本教程中，我们将探讨Tomcat发出的警告消息，该消息通知我们它强制注销了一个JDBC驱动。我们将探索消息的含义、其根本原因以及我们可以采取的缓解措施。</p>\\n<h2>2. 消息及其含义</h2>\\n<p>消息的一个版本可能是以下内容：</p>\\n<div class=\\"language-text\\" data-ext=\\"text\\" data-title=\\"text\\"><pre class=\\"language-text\\"><code>SEVERE: 一个Web应用程序注册了JBDC驱动 [oracle.jdbc.driver.OracleDriver]\\n  但在Web应用程序停止时未能注销它。\\n  为了防止内存泄漏，JDBC驱动已被强制注销。\\n</code></pre></div>","autoDesc":true}');export{m as comp,h as data};
